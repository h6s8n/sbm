@extends('admin.layouts.app')

@section('page_name', ' مدیریت ورود و خروجها -  '.jdate('d-m-Y',strtotime(date('now'))))

@section('content')
    <form method="post">
        {{ csrf_field() }}

        <div class="white-box">

            <div class="portlet-body">
                <div class="table-container">
                    <div class="table-container">

                        <table class="table table-striped table-bordered table-hover">
                            <tbody>
                            <tr role="row" class="heading">
                                <th></th>
                                <th>نام پزشک</th>
                                <th>نام بیمار</th>
                                <th>ساعت ویزیت</th>
                                <th>نوع ویزیت</th>
                                <th>آخرین وروددکتر</th>
                                <th>آخرین ورودبیمار</th>
                                <th>تعداد پیامها</th>
                                <th>اکشنها</th>
                                <th>اعمال</th>
                            </tr>
                            @php $row_count =1 @endphp
                            @foreach($events as $event)
                                <tr role="row" class="filter">
                                    <td>
                                        <svg version="1.1" id="circle-11" xmlns="http://www.w3.org/2000/svg"
                                             width="11px" height="11px" viewBox="0 0 11 11">
                                            <path
                                                style="fill: {{\Illuminate\Support\Facades\Cache::has('user-is-online-'. $event->doctor_id) ? 'green' : 'red'}};width: 50px"
                                                d="M10,5.5C10,7.9853,7.9853,10,5.5,10S1,7.9853,1,5.5S3.0147,1,5.5,1S10,3.0147,10,5.5z"/>
                                        </svg>
                                    </td>
                                    <td>{{ $event->doctor->fullname.'-'.$event->doctor->mobile}}</td>
                                    <td>{{ $event->user->fullname .'-'. $event->user->mobile}}</td>
                                    <td>{{ jdate('H:i', strtotime($event->reserve_time)) }}</td>
                                    <td>{{$event->getVisitTypeString()}}</td>
                                    <td>
                                        @php $last = $event->lastJoin()->first(); @endphp
                                        @if($last)
                                            {{ jdate('Y-m-d ساعت H:i', strtotime($last->created_at))}}
                                        @else
                                            ---
                                        @endif
                                    </td>
                                    <td>
                                        @php $last = $event->lastJoin(2)->first(); @endphp
                                        @if($last)
                                            {{ jdate('Y-m-d ساعت H:i', strtotime($last->created_at))}}
                                        @else
                                            ---
                                        @endif
                                    </td>
                                    <td>
                                        پزشک: {{$event->DoctorMessages()->count()}}
                                        -
                                        بیمار: {{$event->UserMessages()->count()}}
                                    </td>
                                    <td>
                                        <div style="display: flex">
                                            <span class="svgContainer"
                                                  style="width: 35px;height: 25px;display: flex;justify-content: center;align-items: center;border-left: solid 2px">
                                            <svg aria-hidden="true" data-prefix="fad" data-icon="comment-alt-lines"
                                                 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
                                                 class="svg-inline--fa fa-comment-alt-lines fa-w-16"
                                                 style="--fa-secondary-opacity:0.1;width: 20px;">
                                                <g class="fa-group">
                                                    <path fill="currentColor"
                                                          d="M448 0H64A64.06 64.06 0 000 64v288a64.06 64.06 0 0064 64h96v84a12 12 0 0019.1 9.7L304 416h144a64.06 64.06 0 0064-64V64a64.06 64.06 0 00-64-64zM288 264a8 8 0 01-8 8H136a8 8 0 01-8-8v-16a8 8 0 018-8h144a8 8 0 018 8zm96-96a8 8 0 01-8 8H136a8 8 0 01-8-8v-16a8 8 0 018-8h240a8 8 0 018 8z"
                                                          class="fa-secondary"
                                                          style="fill: {{$event->DoctorMessages()->first() ? 'green' : 'red'}};">
                                                        <path fill="currentColor"
                                                              d="M280 240H136a8 8 0 00-8 8v16a8 8 0 008 8h144a8 8 0 008-8v-16a8 8 0 00-8-8zm96-96H136a8 8 0 00-8 8v16a8 8 0 008 8h240a8 8 0 008-8v-16a8 8 0 00-8-8z"
                                                              class="fa-primary"/>
                                                </g>
                                            </svg>
                                        </span>
                                            <span class="svgContainer"
                                                  style="width: 35px;height: 25px;display: flex;justify-content: center;align-items: center;border-left: solid 2px">
                                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg"
                                                 xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                                 viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000"
                                                 xml:space="preserve"
                                                 style="--fa-secondary-opacity:0.1;width: 25px;">
                                                <g>
                                                    <g transform="translate(0.000000,511.000000) scale(0.100000,-0.100000)"
                                                       style="fill: {{$event->logs(\App\Enums\VisitLogEnum::SafeCall)->first() || $event->logs(\App\Enums\VisitLogEnum::AdminCreateCall)->first() ? 'green' : 'red'}};">
                                                        <path
                                                            d="M4549.7,3782.3C2555.3,3680.1,1020.6,3096,392,2201c-222.1-315.4-310.9-624.1-288.7-1001.7c20-373.1,144.4-664.1,377.6-886.2C709.6,97.7,594.1,93.3,1786.8,379.8l1043.9,251l37.7,122.2c26.7,86.6,37.8,202.1,37.8,399.8c0,308.7-46.6,506.4-168.8,726.3c-35.5,64.4-64.4,122.2-64.4,128.8c0,37.8,466.4,222.1,799.6,313.2c983.9,271,2081.1,271,3064.9,0c333.1-91.1,799.6-275.4,799.6-313.2c0-6.7-28.9-64.4-64.4-128.8c-122.2-217.7-168.8-417.5-168.8-726.3c0-199.9,11.1-313.2,37.8-399.8l37.8-122.2l1043.8-251C9415.8,91.1,9300.3,97.7,9529.1,313.2c151,144.4,233.2,275.4,308.7,495.3c55.5,159.9,62.2,208.8,62.2,477.5c0,266.5-6.7,319.8-60,477.5c-226.5,684.1-955,1257.1-2052.2,1616.9c-559.7,184.3-1090.5,290.9-1765.7,359.8C5702.4,3771.2,4836.2,3797.9,4549.7,3782.3z"/>
                                                        <path
                                                            d="M3794.6,2052.2c-235.4-53.3-655.2-184.3-655.2-202.1c0-4.4,20-82.2,46.6-171c31.1-108.8,51.1-251,57.7-450.9c13.3-317.6-15.5-504.2-113.3-757.4L3081.6,342l-555.2-133.3l-553-135.5l-102.2-191c-55.5-104.4-171-277.6-255.4-382c-410.9-515.3-481.9-615.2-561.9-779.6c-208.8-424.2-235.4-590.8-235.4-1532.5v-755.1H5005h4186.5v755.1c0,826.2-13.3,950.6-126.6,1277.1c-106.6,306.5-217.6,482-546.3,875c-226.5,271-295.4,370.9-399.8,575.2l-82.2,159.9l-533,126.6c-293.2,71.1-544.1,133.3-557.5,137.7c-31.1,11.1-106.6,222.1-155.5,424.2c-48.9,215.4-33.3,688.5,33.3,915c26.6,88.8,46.6,166.6,46.6,171c0,37.8-877.3,271-897.3,237.6c-4.4-6.7-20-57.7-35.5-113.3c-13.3-55.5-35.5-137.7-46.7-182.1l-22.2-84.4h-852.9h-852.8l-33.3,117.7c-17.8,62.2-42.2,148.8-51.1,191c-11.1,42.2-28.9,80-40,82.2C4025.5,2101,3916.7,2081,3794.6,2052.2z M5322.6,899.5c548.6-106.6,1019.4-464.2,1259.3-955c144.4-293.2,184.3-468.6,184.3-790.7c-2.2-604.1-279.8-1128.2-770.7-1452.5c-330.9-217.6-604.1-302-990.6-302c-801.8,0-1470.3,504.2-1699,1277.1c-48.9,162.1-60,248.8-62.2,455.3c-4.4,504.2,144.4,886.2,490.8,1248.2C4149.9,815.1,4745.1,1008.3,5322.6,899.5z"/>
                                                        <path
                                                            d="M4609.6,577.5c-328.7-95.5-661.8-344.2-844-630.8c-148.8-237.6-208.8-433.1-222.1-726.3c-8.9-217.6-2.2-284.3,37.7-433.1c75.5-273.2,186.6-462,390.9-666.3c284.3-286.5,633-433.1,1032.7-433.1c399.8,0,748.5,146.6,1032.8,433.1c295.4,293.2,433.1,628.5,433.1,1041.6c0,248.8-40,410.9-159.9,657.4c-73.3,153.2-126.6,224.3-282.1,377.6c-208.8,206.5-404.2,322-659.6,386.4C5180.4,633,4791.8,628.5,4609.6,577.5z M5131.6,319.8c64.4-44.4,102.2-166.6,75.5-237.7c-68.8-184.3-308.7-197.7-390.9-24.4c-44.4,91.1-15.6,208.8,62.2,262.1C4940.6,362,5069.4,362,5131.6,319.8z M4443.1,31.1c26.7-17.8,60-68.9,73.3-111.1c44.4-133.3-60-277.6-199.9-277.6c-139.9,0-244.3,144.4-199.9,277.6c31.1,97.7,97.7,144.4,199.9,144.4C4360.9,64.4,4416.4,48.9,4443.1,31.1z M5842.3,31.1c64.4-44.4,102.2-166.6,75.5-237.6c-28.9-73.3-128.8-151-195.4-151c-208.8,0-299.8,271-131,388.7C5651.3,73.3,5782.3,73.3,5842.3,31.1z M5093.8-513c44.4-11.1,113.3-57.8,155.5-99.9c64.4-66.6,75.5-95.5,82.2-204.3c6.7-102.1,0-144.4-35.5-202.1c-135.5-213.2-448.6-213.2-579.7,0c-57.8,95.5-60,273.2-2.2,357.6c46.6,73.3,115.5,124.4,197.7,148.8C4993.9-488.6,5005-488.6,5093.8-513z M4116.6-657.4c124.4-64.4,148.8-206.6,53.3-319.8c-46.6-57.7-73.3-68.8-148.8-68.8c-99.9,2.2-148.8,28.9-188.8,104.4c-57.7,106.6-22.2,226.5,80,282.1C3990-617.4,4036.6-615.2,4116.6-657.4z M6093.3-657.4c128.8-66.6,148.8-211,48.9-324.3c-48.9-55.5-80-68.8-148.8-68.8c-68.9,0-99.9,13.3-148.8,68.8c-99.9,111-80,255.4,44.4,322C5966.7-617.4,6013.3-615.2,6093.3-657.4z M4429.8-1357c64.4-35.5,113.3-148.8,97.7-222.1c-17.8-84.4-131-177.7-211-177.7c-80,0-193.2,93.3-211,177.7c-15.5,71.1,33.3,184.3,93.3,219.9C4249.9-1330.4,4374.2-1328.1,4429.8-1357z M5842.3-1368.1c64.4-44.4,102.2-166.6,75.5-237.6c-28.9-77.7-128.8-151-204.3-151c-80,0-191,93.3-208.8,177.7c-15.5,71.1,33.3,184.3,93.3,219.9C5657.9-1325.9,5789-1330.4,5842.3-1368.1z M5131.6-1656.8c64.4-44.4,102.2-166.6,75.5-237.7c-68.8-184.3-308.7-197.7-390.9-24.4c-44.4,91-31.1,166.6,44.4,242.1C4922.8-1614.7,5056.1-1603.6,5131.6-1656.8z"/>
                                                    </g>
                                                </g>
                                            </svg>
                                        </span>
                                            <span class="svgContainer"
                                                  style="width: 35px;height: 25px;display: flex;justify-content: center;align-items: center">
                                            <svg style="width: 29px" xmlns="http://www.w3.org/2000/svg"
                                                 viewBox="0 0 48 48" enable-background="new 0 0 48 48">
                                                <path
                                                    style="fill: {{$event->logs(\App\Enums\VisitLogEnum::VideoCall)->first() ? 'green' : 'red'}};"
                                                    d="M8,12h22c2.2,0,4,1.8,4,4v16c0,2.2-1.8,4-4,4H8c-2.2,0-4-1.8-4-4V16C4,13.8,5.8,12,8,12z"/>
                                                <polygon fill="#388E3C" points="44,35 34,29 34,19 44,13"
                                                         style="fill: {{$event->logs(\App\Enums\VisitLogEnum::VideoCall)->first() ? 'green' : 'red'}};">
                                            </svg>
                                        </span>
                                        <?xml version = "1.0" encoding = "iso-8859-1"?>
                                        <!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
                                            <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                                                 xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                                 viewBox="0 0 490 490" style="enable-background:new 0 0 490 490;"
                                                 xml:space="preserve">
<path d="M384.547,31.26H105.453C47.313,31.26,0,79.606,0,139.016v106.739c0,59.411,47.313,107.756,105.453,107.756h176.408
	L410.103,458.74V350.266C456.489,338.453,490,295.745,490,245.755V139.016C490,79.606,442.687,31.26,384.547,31.26z M112.84,238.413
	c-12.486,0-23.612-2.722-30.819-6.624l5.264-21.264c5.458,3.32,16.778,7.223,25.556,7.223c8.972,0,12.681-3.125,12.681-8
	c0-4.89-2.931-7.223-14.041-10.931c-19.709-6.639-27.32-17.361-27.126-28.681c0-17.75,15.223-31.208,38.82-31.208
	c11.125,0,21.085,2.527,26.931,5.458l-5.264,20.486c-4.292-2.348-12.486-5.473-20.681-5.473c-7.223,0-11.32,2.931-11.32,7.806
	c0,4.486,3.708,6.834,15.417,10.931c18.139,6.236,25.75,15.417,25.945,29.459C154.202,225.344,140.16,238.413,112.84,238.413z
	 M316.314,236.469h-28.875V184.58c0-13.862-4.501-21.862-14.056-21.862c-6.819,0-11.709,4.68-13.653,10.348
	c-0.778,2.138-1.166,5.264-1.166,7.611v55.792h-28.875V183.01c0-12.098-4.292-20.292-13.668-20.292
	c-7.596,0-12.098,5.862-13.847,10.737c-0.972,2.333-1.166,5.069-1.166,7.417v55.598h-28.875v-64.973
	c0-11.888-0.389-22.042-0.778-30.431h24.973l1.361,12.875h0.583c4.097-6.041,12.486-15.013,28.875-15.013
	c12.292,0,22.042,6.236,26.139,16.18h0.389c3.514-4.875,7.806-8.778,12.292-11.499c5.279-3.125,11.125-4.68,18.154-4.68
	c18.333,0,32.195,12.875,32.195,41.347V236.469z M365.242,238.413c-12.486,0-23.612-2.722-30.819-6.624l5.264-21.264
	c5.458,3.32,16.778,7.223,25.556,7.223c8.972,0,12.681-3.125,12.681-8c0-4.89-2.931-7.223-14.042-10.931
	c-19.709-6.639-27.32-17.361-27.126-28.681c0-17.75,15.223-31.208,38.82-31.208c11.125,0,21.07,2.527,26.931,5.458l-5.264,20.486
	c-4.292-2.348-12.486-5.473-20.681-5.473c-7.223,0-11.32,2.931-11.32,7.806c0,4.486,3.708,6.834,15.417,10.931
	c18.139,6.236,25.75,15.417,25.945,29.459C406.604,225.344,392.562,238.413,365.242,238.413z"
      fill="{{$event->logs(\App\Enums\VisitLogEnum::PatientInRoom)->first() ? 'green' : 'red'}}"/>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
                                                <g>
                                                </g>
</svg>

                                        </div>

                                    </td>
                                    <td>
                                        <div class="col-xs-6">
                                            <a href="{{route('list.of.visits',['filter_user'=>$event->doctor->fullname,'filter_br'=>$event->user->fullname])}}"
                                               class="btn btn-block btn-success
                                            btn-rounded request_but">
                                                مدیریت
                                            </a>
                                        </div>
                                        <div class="col-xs-6">
                                            <a href="https://wa.me/{{$event->doctor->mobile}}" target="_blank">
                                                <svg
                                                    style="width:25px;fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"
                                                    version="1.1" viewBox="0 0 512 512" width="100%"
                                                    xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                                                    xmlns:serif="http://www.serif.com/"
                                                    xmlns:xlink="http://www.w3.org/1999/xlink"><g
                                                        id="WhatsApp-Logo-Icon">
                                                        <path
                                                            d="M116.225,-0.001c-11.264,0.512 -26.112,1.536 -32.768,3.072c-10.24,2.048 -19.968,5.12 -27.648,9.216c-9.728,4.608 -17.92,10.752 -25.088,17.92c-7.68,7.68 -13.824,15.872 -18.432,25.6c-4.096,7.68 -7.168,17.408 -9.216,27.648c-1.536,6.656 -2.56,21.504 -2.56,32.768c-0.512,4.608 -0.512,10.752 -0.512,13.824l0,251.905l0,13.824c0.512,11.264 1.536,26.112 3.072,32.768c2.048,10.24 5.12,19.968 9.216,27.648c4.608,9.728 10.752,17.92 17.92,25.088c7.68,7.68 15.872,13.824 25.6,18.432c7.68,4.096 17.408,7.168 27.648,9.216c6.656,1.536 21.504,2.56 32.768,2.56c4.608,0.512 10.752,0.512 13.824,0.512l251.904,0l13.824,0c11.264,-0.512 26.112,-1.536 32.768,-3.072c10.24,-2.048 19.968,-5.12 27.648,-9.216c9.728,-4.608 17.92,-10.752 25.088,-17.92c7.68,-7.68 13.824,-15.872 18.432,-25.6c4.096,-7.68 7.168,-17.408 9.216,-27.648c1.536,-6.656 2.56,-21.504 2.56,-32.768c0.512,-4.608 0.512,-10.752 0.512,-13.824l0,-265.729c-0.512,-11.264 -1.536,-26.112 -3.072,-32.768c-2.048,-10.24 -5.12,-19.968 -9.216,-27.648c-4.608,-9.728 -10.752,-17.92 -17.92,-25.088c-7.68,-7.68 -15.872,-13.824 -25.6,-18.432c-7.68,-4.096 -17.408,-7.168 -27.648,-9.216c-6.656,-1.536 -21.504,-2.56 -32.768,-2.56c-4.608,-0.512 -10.752,-0.512 -13.824,-0.512l-265.728,0Z"
                                                            style="fill:url(#_Linear1);fill-rule:nonzero;"/>
                                                        <path
                                                            d="M344.754,289.698c-4.56,-2.282 -26.98,-13.311 -31.161,-14.832c-4.18,-1.521 -7.219,-2.282 -10.259,2.282c-3.041,4.564 -11.78,14.832 -14.44,17.875c-2.66,3.042 -5.32,3.423 -9.88,1.14c-4.561,-2.281 -19.254,-7.095 -36.672,-22.627c-13.556,-12.087 -22.709,-27.017 -25.369,-31.581c-2.66,-4.564 -0.283,-7.031 2,-9.304c2.051,-2.041 4.56,-5.324 6.84,-7.986c2.28,-2.662 3.04,-4.564 4.56,-7.606c1.52,-3.042 0.76,-5.705 -0.38,-7.987c-1.14,-2.282 -10.26,-24.72 -14.06,-33.848c-3.701,-8.889 -7.461,-7.686 -10.26,-7.826c-2.657,-0.132 -5.7,-0.16 -8.74,-0.16c-3.041,0 -7.98,1.141 -12.161,5.704c-4.18,4.564 -15.96,15.594 -15.96,38.032c0,22.438 16.34,44.116 18.62,47.159c2.281,3.043 32.157,49.089 77.902,68.836c10.88,4.697 19.374,7.501 25.997,9.603c10.924,3.469 20.866,2.98 28.723,1.806c8.761,-1.309 26.98,-11.029 30.781,-21.677c3.799,-10.649 3.799,-19.777 2.659,-21.678c-1.139,-1.902 -4.179,-3.043 -8.74,-5.325m-83.207,113.573l-0.061,0c-27.22,-0.011 -53.917,-7.32 -77.207,-21.137l-5.539,-3.287l-57.413,15.056l15.325,-55.959l-3.608,-5.736c-15.184,-24.145 -23.203,-52.051 -23.192,-80.704c0.033,-83.611 68.083,-151.635 151.756,-151.635c40.517,0.016 78.603,15.811 107.243,44.474c28.64,28.663 44.404,66.764 44.389,107.283c-0.035,83.617 -68.083,151.645 -151.693,151.645m129.102,-280.709c-34.457,-34.486 -80.281,-53.487 -129.103,-53.507c-100.595,0 -182.468,81.841 -182.508,182.437c-0.013,32.156 8.39,63.546 24.361,91.212l-25.892,94.545l96.75,-25.37c26.657,14.535 56.67,22.194 87.216,22.207l0.075,0c100.586,0 182.465,-81.852 182.506,-182.448c0.019,-48.751 -18.946,-94.59 -53.405,-129.076"
                                                            style="fill:#fff;"/>
                                                    </g>
                                                    <defs>
                                                        <linearGradient
                                                            gradientTransform="matrix(0,-512,-512,0,256.001,512)"
                                                            gradientUnits="userSpaceOnUse" id="_Linear1" x1="0" x2="1"
                                                            y1="0" y2="0">
                                                            <stop offset="0" style="stop-color:#25cf43;stop-opacity:1"/>
                                                            <stop offset="1" style="stop-color:#61fd7d;stop-opacity:1"/>
                                                        </linearGradient>
                                                    </defs></svg>
                                            </a>
                                        </div>
                                        @if(!$event->logs(\App\Enums\VisitLogEnum::PatientInRoom)->first() &&
!$event->logs(\App\Enums\VisitLogEnum::AdminPatientInRoom)->first())
                                            <div class="col-xs-12">
                                                <a href="{{route('admin.sent.patient.sms',$event)}}"
                                                   class="btn btn-block btn-warning
                                            btn-rounded request_but">
                                                    ارسال پیامک به پزشک
                                                </a>
                                            </div>
                                        @endif
                                    </td>
                                </tr>
                                @php $row_count = $row_count +1;@endphp
                            @endforeach
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>

        </div>
    </form>
    <div id="app"></div>
    <script src="{{asset('js/app.js')}}"></script>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <script>
        const ch = window.Echo.channel('chat');
    </script>
@endsection

